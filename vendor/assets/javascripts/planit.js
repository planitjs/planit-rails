var Planit,__bind=function(t,n){return function(){return t.apply(n,arguments)}};Planit=function(){function t(){this.initMarkers=__bind(this.initMarkers,this)}return t.prototype["new"]=function(t){return this.options=t,this.options||(this.options={}),this.setOptions(),this.initPlan(),$(window).load(this.initMarkers)},t.prototype.setOptions=function(){return this.setDefaultOptions(),this.options.container&&(this.planOptions.container=$("#"+this.options.container)),this.options.backgroundImage?this.planOptions.backgroundImage=this.options.backgroundImage:void 0},t.prototype.setDefaultOptions=function(){return this.planOptions={container:$("#planit")}},t.prototype.initPlan=function(){return this.plan=new t.Plan(this.planOptions)},t.prototype.initMarkers=function(){var n,i,r,o,a;for(this.markers=new t.Marker({plan:this.planOptions.container}),o=this.options.markers,a=[],i=0,r=o.length;r>i;i++)n=o[i],a.push(this.markers.add(n));return a},t}(),window.planit=new Planit,Planit.Plan=function(){function t(t){this.options=t,this.initContainers(),this.options.backgroundImage&&this.addBackgroundImage()}return t.prototype.initContainers=function(){return this.options.container.addClass("planit-container"),this.options.container.append('<div class="planit-markers-container"></div>')},t.prototype.addBackgroundImage=function(){return this.options.container.append('<img src="'+this.options.backgroundImage+'">'),this.options.container.find(".planit-markers-container").css({backgroundImage:"url('"+this.options.backgroundImage+"')"}),$(window).load(function(t){return function(){return t.options.container.css({height:t.options.container.find("img").first().height()}),t.options.container.find("img").first().remove()}}(this))},t}(),Planit.Marker=function(){function t(t){this.options=t,this.mousemove=__bind(this.mousemove,this),this.mouseup=__bind(this.mouseup,this),this.mousedown=__bind(this.mousedown,this),this.setOptions(),this.bindDraggable()}return t.prototype.setOptions=function(){return this.plan=this.options.plan,this.markersContainer=this.plan.find(".planit-markers-container")},t.prototype.add=function(t){var n,i;return this.markersContainer.append($('<div><div class="planit-marker-content"></div></div>').addClass("planit-marker").css({left:t.coords[0]+"%",top:t.coords[1]+"%"})),t.draggable&&(this.lastMarker().addClass("draggable"),this.lastMarker().on("mousedown",this.mousedown)),t.infobox?(n=this.randomString(16),this.lastMarker().find(".planit-marker-content").append('<div class="planit-infobox" id="info-'+n+'">'+t.infobox+"</div>"),this.lastMarker().attr("data-infobox","info-"+n),i=$("#"+this.lastMarker().attr("data-infobox")),i.css({left:-(i.width()/2),bottom:i.outerHeight()+5}),this.lastMarker().on("mouseleave",function(){return function(t){var n;return n=$(t.target).closest(".planit-marker"),i=$("#"+n.attr("data-infobox")),i.removeClass("active")}}(this)),this.lastMarker().on("mouseover",function(t){return function(n){var r;return r=$(n.target).closest(".planit-marker"),i=$("#"+r.attr("data-infobox")),r.hasClass("is-dragging")||t.draggingMarker().length>0?i.removeClass("active"):i.addClass("active")}}(this))):void 0},t.prototype.mousedown=function(t){var n,i;return i=$(t.target).closest(".planit-marker"),i.addClass("is-dragging"),n=$(t.target).closest(".planit-marker").attr("data-infobox"),$("#"+n).removeClass("active")},t.prototype.mouseup=function(t){var n;return $(t.target).hasClass("planit-marker-content")&&(n=$(t.target).closest(".planit-marker"),$("#"+n.attr("data-infobox")).addClass("active")),this.draggingMarker().removeClass("is-dragging")},t.prototype.mousemove=function(t){var n,i,r,o,a,s,e,p,u,d,h,l,c,g;return d=this.markersContainer.find(".planit-marker.is-dragging"),d.length>0?(n=d.first(),h=t.pageX-this.plan.offset().left,l=t.pageY-this.plan.offset().top,g=this.plan.width(),c=this.plan.height(),o=h-n.outerWidth()/2,s=l-n.outerHeight()/2,a=h+n.outerWidth()/2,i=l+n.outerHeight()/2,e=n.outerWidth(),r=n.outerHeight(),p=0>=o?0:g>a?o:g-e,u=0>=s?0:c>i?s:c-r,n.css({left:p,top:u})):void 0},t.prototype.bindDraggable=function(){return $(document).on("mousemove",this.mousemove),$(document).on("mouseup",this.mouseup)},t.prototype.markers=function(){return this.markersContainer.find(".planit-marker")},t.prototype.draggingMarker=function(){return this.markersContainer.find(".planit-marker.is-dragging")},t.prototype.lastMarker=function(){return this.markers().last()},t.prototype.randomString=function(t){var n;return null==t&&(t=16),n=Math.random().toString(36).slice(2),n+=Math.random().toString(36).slice(2),n.substring(0,t-1)},t}();